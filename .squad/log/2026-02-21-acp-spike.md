# Session: ACP Spike Implementation
**Date:** 2026-02-21  
**Issue:** #370  
**Branch:** squad/370-acp-spike  
**Team:** Jaguar (protocol), Morty (UI), Meeseeks (testing)

## Summary

Completed ACP protocol spike for EditLess Copilot CLI integration. Built three-layer foundation: types, client, handlers. Added VS Code surface (panel, extension integration) and comprehensive test coverage (44 tests). Ready for evaluation of ACP viability vs. terminal+events.jsonl approach.

## What Was Built

### Protocol Layer (Jaguar)
- `src/acp/types.ts`: 272 lines — Full JSON-RPC type definitions, discriminated unions
- `src/acp/client.ts`: 342 lines — Headless ACP client engine, NDJSON streaming
- `src/acp/handlers.ts`: 89 lines — Spike handler (auto-approve, read fs, stub write/terminal)

### VS Code Integration (Morty)
- `src/acp/panel.ts`: WebviewPanel UI for ACP output
- `src/extension.ts`: Updated with ACP client lifecycle
- `package.json`: Added @agentclientprotocol/sdk, updated scripts

### Test Coverage (Meeseeks)
- `src/__tests__/acp-client.test.ts`: 24 tests — client lifecycle, streaming, JSON-RPC
- `src/__tests__/acp-handlers.test.ts`: 20 tests — permissions, fs, error handling

## Key Insights

**Architecture insight**: ACP is fundamentally bidirectional JSON-RPC. Agent makes requests TO client (fs/read, terminal/create, permissions). This flips the UI ownership model — EditLess becomes the UI driver instead of observing Copilot's terminal.

**Decision made**: For production, stick with Option A (terminal + events.jsonl + --resume). ACP provides typed protocol and permission interception, but requires rebuilding full Copilot UI. Terminal mode is stable, proven, user-familiar.

**Spike conclusion**: ACP is viable for future full-panel integration. Protocol is sound, SDK is usable, Copilot CLI support is solid (public preview). Not recommended for Phase 1, but documented and tested for Phase 2 evaluation.

## Decisions Recorded

- `jaguar-acp-spike-architecture.md`: Architecture, patterns, next steps
- `jaguar-acp-deep-dive.md`: Deep technical analysis of ACP spec, three options comparison, Phase 1/2 recommendations

## Test Count

44 new tests validating protocol, client, handlers, and error paths.
