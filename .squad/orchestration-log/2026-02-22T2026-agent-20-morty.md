# Orchestration Log: agent-20-morty

**Agent:** Morty (Extension Dev)  
**Task:** Extract shared launch-utils.ts from duplicated launchFromWorkItem/launchFromPR code  
**Mode:** background  
**Model:** claude-sonnet-4.5  
**Status:** ✅ SUCCESS  
**Timestamp:** 2026-02-22T20:26Z

## Task Summary

Eliminate code duplication in terminal launch orchestration by extracting shared utilities from `launchFromWorkItem` and `launchFromPR` commands into a reusable module.

## Outcome

### Files Created
- `src/launch-utils.ts` (51 lines) — Exports `MAX_SESSION_NAME`, `buildSessionName()`, `launchAndLabel()`
- `src/__tests__/launch-utils.test.ts` (164 lines) — 14 comprehensive test cases

### Files Modified
- `src/extension.ts` — Integrated new utilities; reduced by 20 lines via deduplication

### Test Results
- **New tests:** 14
- **Total tests passing:** 774
- **Coverage:** Launch truncation logic, ellipsis handling, edge cases, real-world scenarios

## Implementation

### Exported Utilities

1. **`MAX_SESSION_NAME`** (constant: 50)  
   Single source of truth for session name length limit across all launch contexts.

2. **`buildSessionName(rawName: string): string`**  
   Pure function handling name truncation:
   - Returns unchanged if ≤ 50 chars
   - Smart word-boundary truncation (breaks at last space before limit)
   - Hard truncation fallback if no space exists
   - Appends ellipsis (`…`) to truncated names

3. **`launchAndLabel(terminalManager, labelManager, cfg, rawName): Terminal`**  
   Orchestration wrapper:
   - Calls `buildSessionName()` to process name
   - Launches terminal via terminalManager
   - Sets label via labelManager
   - Returns created terminal

## Rationale

- **DRY:** Eliminated 24 lines of identical code (12 lines × 2 locations)
- **Testability:** Isolated functions with clear contracts
- **Maintainability:** Truncation logic now centralized
- **Type Safety:** Proper TypeScript contracts for all exports
- **Reusability:** Pattern ready for future terminal-launch commands

## Related Issues

- #337: Launch Progress Indicator (parent epic)
- #394: Refactor BaseTreeProvider extraction (follow-up)
- #395: Separate editless-tree state from UI (follow-up)
- #396: Consolidate discovery.ts and unified-discovery.ts (follow-up)

---

**End Time:** 2026-02-22T20:26Z  
**Commit:** 968ee06  
**Branch:** squad/337-launch-progress-indicator
